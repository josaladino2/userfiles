#!/bin/bash
fctn=($@)
endfctn="}"
gotit=0
func_dir="${HOME}/.mybfuncs"
InFile=~/.bash_functions
. ${InFile}
if [ -e "${InFile}" ]; then
	for f in "${fctn[@]}"
	do
		( while IFS= read -r line; do
# Print last line of selected function
			if [ ${gotit} -eq 1 ] && [[ "${line}" =~ ^"${endfctn}".* ]]; then
				( echo "${line}"
				echo "export ${f}" ) >> /dev/stdout
				gotit=2
			fi
			# Print lines in between $f and $endfctn
			if [ ${gotit} -eq 1 ]; then
				echo "${line}" >> /dev/stdout
			fi
			# Print first line of function
			if [[ "${line}" =~ ^"${f}".* ]] && [ ${gotit} -eq 0 ]; then
				( echo "# bash Function ${f}"
				echo "${line}" ) > /dev/stdout
				gotit=1
			fi
			if [ ${gotit} -eq 2 ]; then
				break
			fi
			done < ${InFile} ) > ${func_dir}/${f} \
				2>${func_dir}/${f}_Errors
			set -a; . ${func_dir}/${f}; set +a # function in shell
			#rm -f ${lfunc_dir}/${f}
			if [ ! -s ${func_dir}/${f}_Errors ]; then
				rm ${func_dir}/${f}_Errors
		fi
	done
else
	printf "can't find ${InFile}\n"
fi
