#!/bin/bash
fctn=($@)
endfctn="}"
gotit=0
tmp_dir="${HOME}/tmp"
if [ -e "${HOME}/.bash_functions" ]; then
	for f in "${fctn[@]}"
	do
		( while IFS= read -r line; do
# Print last line of selected function
			if [ ${gotit} -eq 1 ] && [[ "${line}" =~ ^"${endfctn}".* ]]; then
				( echo "${line}"
				echo "export ${f}" ) >> /dev/stdout
				gotit=2
			fi
			# Print lines in between $f and $endfctn
			if [ ${gotit} -eq 1 ]; then
				echo "${line}" >> /dev/stdout
			fi
			# Print first line of function
			if [[ "${line}" =~ ^"${f}".* ]] && [ ${gotit} -eq 0 ]; then
				( echo "#!/bin/bash"
				echo "# Function ${f}"
				echo "${line}" ) > /dev/stdout
				gotit=1
			fi
			if [ ${gotit} -eq 2 ]; then
				break
			fi
			done < ${HOME}/.bash_functions ) > ${tmp_dir}/${f} \
				2>${tmp_dir}/${f}_Errors
			set -a; . ${tmp_dir}/${f}; set +a # function in shell
			#rm -f ${ltmp_dir}/${f}
			if [ ! -s ${tmp_dir}/${f}_Errors ]; then
				rm ${tmp_dir}/${f}_Errors
		fi
	done
	else
		printf "can't find ${HOME}/.bash_functions\n"
	fi
