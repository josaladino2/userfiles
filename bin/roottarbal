#!/usr/local/bin/zsh
SECONDS=0
cd /
FileDate="${1:-$(date +%F)}"

check_error () {
	local result=${1}
	if [ ${result} -eq 0 ]; then
		printf "OK\n\n"
	else
		printf "FAILED!\n\n"
		r_errors=$((r_errors+1))
	fi
}

# Work starts here
r_errors=0
# Backup /root directory
FileName="root-dir-${FileDate}.tgz"
rm -f /cpbackup/${FileDate}/${FileName} >/dev/null 2>&1
printf "\n** Making /root tarball (/cpbackup/${FileDate}/${FileName})..."
tar -czf /cpbackup/${FileDate}/${FileName} -X ~/root-Exclude root 2> root/roottarbal.err
ls -hla cpbackup/${FileDate}/${FileName}
# Backup /home/elton directory
FileName="elton-dir-${FileDate}.tgz"
rm -f /cpbackup/${FileDate}/${FileName} >/dev/null 2>&1
printf "\n** Making /home/elton tarball (/cpbackup/${FileDate}/${FileName})..."
tar -czf /cpbackup/${FileDate}/${FileName} -X ~/elton-Exclude home/elton 2>> root/roottarbal.err
ls -hla cpbackup/${FileDate}/${FileName}
# Show number of t_errors during Backup transfer.
echo -e "\nTarbals completed with ${r_errors} errors.\n"
# Show time to do the transfer
duration=${SECONDS}
echo -e "\n** /root tarbal completed in $(show_time ${duration})\n"
